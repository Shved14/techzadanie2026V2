<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ - –ú–µ–¥–ü–æ—Ä—Ç–∞–ª</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo">
                <h1 onclick="redirect('/index.html')" style="cursor: pointer;">üè• –ú–µ–¥–ü–æ—Ä—Ç–∞–ª</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-header" id="loginBtn">–í—Ö–æ–¥</button>
                <button class="btn btn-header" id="logoutBtn" style="display: none;">–í—ã—Ö–æ–¥</button>
                <button class="btn btn-header" onclick="redirect('/register.html')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
        </div>
    </header>

    <div class="auth-container">
        <div class="auth-card">
            <div class="card fade-in">
                <h1 class="auth-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>

                <form id="loginForm">
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" name="email" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <div style="position: relative;">
                            <input type="password" id="password" name="password" class="form-input"
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å" required>
                            <button type="button" id="togglePassword"
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px;"
                                onclick="togglePasswordVisibility('password', 'togglePassword')">
                                üëÅÔ∏è
                            </button>
                        </div>
                    </div>

                    <button type="submit" id="loginButton" class="btn btn-primary btn-block">
                        –í–æ–π—Ç–∏
                    </button>
                </form>

                <div class="auth-links">
                    <p>–ï—â–µ –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="/register.html">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateAuthButtons() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            if (isAuthenticated()) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            updateAuthButtons();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            if (isAuthenticated()) {
                checkBirthday();
            }

            // –ö–Ω–æ–ø–∫–∞ "–í—Ö–æ–¥"
            document.getElementById('loginBtn').addEventListener('click', function () {
                redirect('/login.html');
            });

            // –ö–Ω–æ–ø–∫–∞ "–í—ã—Ö–æ–¥"
            document.getElementById('logoutBtn').addEventListener('click', function () {
                removeAuthToken();
                showMessage('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'success');
                updateAuthButtons();
                redirect('/index.html');
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (isAuthenticated()) {
                redirect('/dashboard.html');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!isValidEmail(email)) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å', 'error');
                return;
            }

            if (!isValidPassword(password)) {
                showMessage('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            setButtonLoading('loginButton', true);

            try {
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                setAuthToken(response.token);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                showMessage('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');

                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                setTimeout(() => {
                    redirect('/dashboard.html');
                }, 1000);

            } catch (error) {
                showMessage(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ', 'error');
            } finally {
                setButtonLoading('loginButton', false);
            }
        });
    </script>
</body>

</html>