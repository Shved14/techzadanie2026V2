<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/dashboard" class="logo">üéâ –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π</a>
                <div>
                    <span id="userName" style="margin-right: 1rem;"></span>
                    <button id="logoutButton" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main>
        <!-- –°–µ–∫—Ü–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <section class="dashboard-header">
            <div class="container">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar"></div>
                    <h1 class="user-name" id="userFullName"></h1>
                    <p class="user-email" id="userEmail"></p>
                    <p class="user-birthdate" id="userBirthdate"></p>
                </div>
            </div>
        </section>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <section class="container">
            <div class="grid grid-cols-3">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div class="stats-card">
                    <div class="stats-title">–î–Ω–µ–π –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                    <div class="stats-value" id="daysUntilBirthday">-</div>
                </div>

                <div class="stats-card">
                    <div class="stats-title">–í–æ–∑—Ä–∞—Å—Ç</div>
                    <div class="stats-value" id="userAge">-</div>
                </div>

                <div class="stats-card">
                    <div class="stats-title">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                    <div class="stats-value" style="color: var(--success-color);">–ê–∫—Ç–∏–≤–µ–Ω</div>
                </div>
            </div>

            <!-- –î–µ–º–æ-–∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="card" style="margin-top: 2rem;">
                <h2 style="color: var(--primary-color); margin-bottom: 1rem;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É!</h2>
                <p style="line-height: 1.6; margin-bottom: 1rem;">
                    –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    –∏ –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ —ç—Ç–æ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–π –¥–µ–Ω—å.
                </p>
                <p style="line-height: 1.6; margin-bottom: 1rem;">
                    <strong>–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</strong>
                </p>
                <ul style="line-height: 1.8; padding-left: 2rem;">
                    <li>üéÇ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è</li>
                    <li>üéâ –ö—Ä–∞—Å–∏–≤—ã–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–º —Å—Ç–∏–ª–µ</li>
                    <li>üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</li>
                    <li>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
                </ul>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
            <div class="grid grid-cols-2" style="margin-top: 2rem;">
                <div class="card">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤–∞–∂–Ω—ã–µ –¥–∞—Ç—ã
                        –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–∞—Å –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö.
                    </p>
                    <button class="btn btn-accent" style="margin-top: 1rem;">
                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                </div>

                <div class="card">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">üéÅ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        –ö–∞–∂–¥–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ
                        —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π.
                    </p>
                    <button class="btn btn-accent" style="margin-top: 1rem;">
                        –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ
                    </button>
                </div>
            </div>

        </section>
    </main>

    <script src="/js/common.js"></script>
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            try {
                const response = await apiRequest('/user/profile');
                const user = response.user;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ö–µ–¥–µ—Ä–µ
                document.getElementById('userName').textContent = user.fullName;

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                document.getElementById('userFullName').textContent = user.fullName;
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userBirthdate').textContent = '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: ' + formatDate(user.birthDate);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã –≤ –∞–≤–∞—Ç–∞—Ä
                const initials = user.fullName
                    .split(' ')
                    .map(word => word.charAt(0))
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);
                document.getElementById('userAvatar').textContent = initials;

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                const birthDate = new Date(user.birthDate);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();

                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                document.getElementById('userAge').textContent = age + ' –ª–µ—Ç';

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–Ω–µ–π –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è
                const nextBirthday = new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate());

                if (nextBirthday < today) {
                    nextBirthday.setFullYear(today.getFullYear() + 1);
                }

                const daysUntil = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));

                if (daysUntil === 0) {
                    document.getElementById('daysUntilBirthday').textContent = '–°–µ–≥–æ–¥–Ω—è! üéâ';
                    document.getElementById('daysUntilBirthday').style.color = 'var(--accent-color)';
                } else if (daysUntil === 1) {
                    document.getElementById('daysUntilBirthday').textContent = '–ó–∞–≤—Ç—Ä–∞! üéÇ';
                    document.getElementById('daysUntilBirthday').style.color = 'var(--accent-color)';
                } else {
                    document.getElementById('daysUntilBirthday').textContent = daysUntil;
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            removeAuthToken();
            showMessage('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
            setTimeout(() => {
                redirect('/login');
            }, 1000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
        document.getElementById('logoutButton').addEventListener('click', logout);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function () {
            if (!isAuthenticated()) {
                redirect('/login');
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è
            checkBirthday();
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('btn-accent')) {
                showMessage('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'error');
            }
        });
    </script>
</body>

</html>